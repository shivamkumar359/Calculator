<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Calculator</title>

<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#2b2b2b" media="(prefers-color-scheme: dark)">
</head>

<body>
<div class="app">

  <!-- TOP -->
  <div class="top">
    <div
      id="display"
      class="display"
      contenteditable="true"
      inputmode="none"
      spellcheck="false"
    ></div>
    <div class="icon" onclick="toggleHistory()">ðŸ•˜</div>
  </div>

  <!-- HISTORY -->
  <div class="history" id="historyBox">
    <div id="historyList"></div>
    <button class="history-clear" onclick="clearHistory()">Clear History</button>
  </div>

  <!-- HAPTIC CONTROL -->
  <div class="controls">
    <label>Haptic</label>
    <input type="range" min="0" max="50" value="20" id="vibe">
  </div>

  <!-- EDIT CONTROLS -->
  <div class="edit-row">
    <button class="backspace-btn" onclick="backspace()">âŒ«</button>
    <button onclick="clearAll()">C</button>
  </div>

  <!-- KEYPAD -->
  <div class="pad">
    <button class="num" onclick="insert('7')">7</button>
    <button class="num" onclick="insert('8')">8</button>
    <button class="num" onclick="insert('9')">9</button>
    <button class="op" onclick="insert('/')">Ã·</button>

    <button class="num" onclick="insert('4')">4</button>
    <button class="num" onclick="insert('5')">5</button>
    <button class="num" onclick="insert('6')">6</button>
    <button class="op" onclick="insert('*')">Ã—</button>

    <button class="num" onclick="insert('1')">1</button>
    <button class="num" onclick="insert('2')">2</button>
    <button class="num" onclick="insert('3')">3</button>
    <button class="op" onclick="insert('-')">âˆ’</button>

    <div class="bottom">
      <button class="num" onclick="insert('.')">.</button>
      <button class="num" onclick="insert('0')">0</button>
      <button class="eq" onclick="calculate()">=</button>
    </div>

    <button class="op" onclick="insert('+')">+</button>
  </div>
</div>

<script>
/* ===== ELEMENTS ===== */
const d = document.getElementById("display");
const vibe = document.getElementById("vibe");
const historyBox = document.getElementById("historyBox");
const historyList = document.getElementById("historyList");

/* ===== HAPTIC ===== */
function vibrate(){
  const t = +vibe.value;
  if (t && navigator.vibrate) navigator.vibrate(t);
}

/* ===== PREVENT ANDROID KEYBOARD ===== */
function keepFocusWithoutKeyboard(){
  d.blur();   // kill IME
  d.focus();  // restore caret only
}

/* ===== INPUT HANDLING ===== */
function insert(text){
  vibrate();
  keepFocusWithoutKeyboard();
  document.execCommand("insertText", false, text);
}

function backspace(){
  vibrate();
  keepFocusWithoutKeyboard();
  document.execCommand("delete");
}

function clearAll(){
  vibrate();
  d.textContent = "";
}

/* ===== CALCULATE ===== */
function calculate(){
  vibrate();
  try{
    const exp = d.textContent;
    if (!exp.trim()) return;
    const result = eval(exp);
    saveHistory(`${exp} = ${result}`);
    d.textContent = result;
  } catch {
    d.textContent = "Error";
  }
}

/* ===== HISTORY ===== */
function toggleHistory(){
  historyBox.style.display =
    historyBox.style.display === "block" ? "none" : "block";
}

function saveHistory(entry){
  let h = JSON.parse(localStorage.getItem("calcHistory") || "[]");
  h.unshift(entry);
  localStorage.setItem("calcHistory", JSON.stringify(h.slice(0,10)));
  renderHistory();
}

function renderHistory(){
  const h = JSON.parse(localStorage.getItem("calcHistory") || "[]");
  historyList.innerHTML = h.length ? h.join("<br>") : "No history";
}

function clearHistory(){
  localStorage.removeItem("calcHistory");
  renderHistory();
}

/* ===== INIT ===== */
renderHistory();

/* ===== SERVICE WORKER (GITHUB PAGES SAFE) ===== */
if ("serviceWorker" in navigator){
  navigator.serviceWorker.register("./sw.js");
}
</script>

</body>
</html>
